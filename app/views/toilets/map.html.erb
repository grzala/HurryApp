<h1>MAP</h1>

<div id="map"><div id="map-canvas">
	<script type="text/javascript">
		var map;
		function initMap() {
		  map = new google.maps.Map(document.getElementById('map'), {
			center: {lat: 53.0, lng: -1.0 },
			zoom: 6
		  });
		  
		  var osgb; var wgs84; var latitude; var longitude;
		  
		<% @coordinates.each do |c| %>
			latitude = <%= c[:lat] %>; longitude = <%= c[:lng] %>;
			<% if c[:ref] == "OSGB36" %>
				//convert to WGS84
				osgb=new GT_OSGB();
				osgb.setGridCoordinates(<%= c[:lng] %>, <%= c[:lat] %>);
				wgs84 = osgb.getWGS84();		
				latitude = wgs84.latitude; longitude = wgs84.longitude;
			<% end %>
			
			var marker = new google.maps.Marker({
				position: {lat: latitude, lng: longitude },
				map: map
			});
			
		<% end %>
		}

		// W3C location
		if(navigator.geolocation) {
		browserSupportFlag = true;
		navigator.geolocation.getCurrentPosition(function(position) {			
		  initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
		  map.setCenter(initialLocation);
		}, function() {});
		}

	</script>
</div></div>

<!-- GOOGLE MAPS -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsrwi8Uo3FnFtArv67k4sxWbTNz6kGN24&callback=initMap"></script>
<!-- GOOGLE MAPS -->
